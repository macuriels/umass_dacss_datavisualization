---
title: "MiguelCuriel_FinalProject_Deliverable1"
output: html_document
date: "2024-02-25"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(ggplot2)
library(stringr)
library(plotly)
library(forcats)
```

Initial pull of all of the data.

```{r}
# Set the directory containing the CSV files
folder_path <- "Job Postings"

# Get a list of all CSV files in the folder
file_list <- list.files(folder_path, pattern = "\\.csv$", full.names = TRUE)

# Initialize an empty list to store data frames
dfs <- list()

# Loop through each file, read it, add a column with the file name, and append it to the list
for (file in file_list) {
  file_name <- tools::file_path_sans_ext(basename(file))
  df <- read.csv(file)
  df$FileName <- file_name
  dfs[[length(dfs) + 1]] <- df
}

# Combine all data frames into a single data frame
combined_df <- do.call(rbind, dfs)

# Reset row names
row.names(combined_df) <- NULL

# Drop the "Scraped.At" column
combined_df <- subset(combined_df, select = -c(Scraped.At))

# Clean up file names to identify each post
combined_df$FileName <- gsub("_.*", "", combined_df$FileName)  # Remove everything after the underscore
combined_df$FileName <- gsub("(\\p{L})(\\p{Lu})", "\\1 \\2", combined_df$FileName, perl = TRUE)  # Add space between letters and uppercase
```

Removing duplicates and bringing file names (search queries) together.

```{r}
# Group by Detail.URL and aggregate FileName
df <- combined_df %>%
  group_by(Detail.URL) %>%
  summarize(FileName = paste(unique(FileName), collapse = "; "),
            across(everything(), first))
```

Extracting number of employees, and filling nulls for that column as well as employer.

```{r}
# Assuming your data frame is called df
df$NumEmployees <- gsub("(^[0-9,-]+\\+?) .*", "\\1", df$Insight)

# Update NumEmployees column if it's empty
df$NumEmployees <- ifelse(df$NumEmployees == "", "Not specified", df$NumEmployees)

# Update Company.Name column if it's empty
df$Company.Name <- ifelse(df$Company.Name == "", "Not specified", df$Company.Name)
```

Wrangling data to extract salary information.

```{r}
# Remove commas from the Description column
df$Description <- gsub(",", "", df$Description)

# Extract salary ranges
df$SalaryLowRange <- as.numeric(gsub(".*?(pay|pay range|compensation|salary).*?\\$([0-9,]{2,6}).*", "\\2", df$Description, ignore.case = TRUE))
df$SalaryHighRange <- as.numeric(gsub(".*\\$([0-9,]+).*", "\\1", df$Description))

# Transform numbers lower than 5 digits to NA
df$SalaryLowRange <- ifelse(df$SalaryLowRange < 10000, NA, df$SalaryLowRange)
df$SalaryHighRange <- ifelse(df$SalaryHighRange < 10000, NA, df$SalaryHighRange)

# Calculate the average
df$AverageSalary <- rowMeans(df[, c("SalaryLowRange", "SalaryHighRange")], na.rm = TRUE)
```

Counting the times that "ai" or "artificial intelligence" occurs in a text.
```{r}
# Create a new column with the count of "ai" or "artificial intelligence"
df$AI_Count <- str_count(tolower(df$Description), "\\b(ai|artificial intelligence)(?=/|\\b)|(?<=/|\\b)(ai|artificial intelligence)\\b")

# Also create a binary column for ai
df$AI_Binary <- ifelse(df$AI_Count > 0, 1, 0)
```

Create column with enterprise size based on number of employees.
```{r}
df <- df %>%
  mutate(EnterpriseSize = case_when(
    NumEmployees == "Not Specified" ~ "Not Specified",
    NumEmployees == "1-10" ~ "Micro Enterprise",
    NumEmployees %in% c("11-50", "11-49") ~ "Small Enterprise",
    NumEmployees %in% c("51-200", "201-500") ~ "Medium Enterprise",
    NumEmployees %in% c("501-1,000", "1,001-5,000", "5,001-10,000", "10,001+") ~ "Large Enterprise",
    TRUE ~ "Other"
  ))
```


Export resulting dataset.

```{r}
write.csv(df, 'jobpostings_dataset.csv', row.names=FALSE)
```

\-

\-

\-


\-

\-

\-


